(()=>{"use strict";var e={268:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.userLogout=t.userLogin=void 0;const a=s(364),o=s(756),n=r(s(674)),i=r(s(722)),{sign:u}=i.default;let d=[];t.userLogin=[o.body("mobileNumber").isLength({min:1}).trim().withMessage("userName must be specified."),o.body("password").isLength({min:1}).trim().withMessage("Password must be specified."),o.sanitizeBody("email").escape(),o.sanitizeBody("password").escape(),(e,t)=>{try{const s=o.validationResult(e),{mobileNumber:r,password:i}=e.body;if(!s.isEmpty())return a.validationErrorWithData(t,"Validation Error.",s.array());n.default.findOne({mobileNumber:r}).then((e=>{if(e){if(e.password==i){const s={_id:e._id,userName:e.userName,mobileNumber:e.mobileNumber},r=s,o={expiresIn:86400};return s.token=u(r,"7032300186",o),a.successResponseWithData(t,"Login Success.",s)}return a.unauthorizedResponse(t,"MobileNumber or Password wrong.")}return a.unauthorizedResponse(t,"MobileNumber or Password wrong.")})).catch((e=>a.ErrorResponse(t,e)))}catch(e){return a.ErrorResponse(t,e)}}],t.userLogout=async function(e,t){try{const s=o.validationResult(e),{accessToken:r}=e.body;if(!s.isEmpty())return a.validationErrorWithData(t,"Validation Error.",s.array());d=[...d.filter((e=>r!==e))],a.successResponse(t,"User Logged Out")}catch(e){return a.ErrorResponse(t,e)}}},929:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteMatch=t.getTournaments=t.updateTournamentUser=t.updateMatch=t.voteMatch=t.createMatch=t.tournamentDelete=t.tournamentRegister=t.test=void 0;const a=r(s(997)),o=r(s(674)),n=s(756),i=s(364);t.test=[(e,t)=>i.successResponseWithData(t,"Ho Ho Ho !!",null)],t.tournamentRegister=[n.body("title").isLength({min:1}).trim().withMessage("Tournament name must be specified.").custom((e=>a.default.findOne({title:e}).then((e=>{if(e)return Promise.reject("Tournament already in use")})))),n.sanitizeBody("title").escape(),(e,t)=>{try{const s=n.validationResult(e);if(!s.isEmpty())return i.validationErrorWithData(t,"Validation Error.",s.array());new a.default({title:e.body.title}).save().then((e=>(console.log("=====>> Success",e),i.successResponseWithData(t,"Tournament Created",e)))).catch((e=>(console.log(e),i.ErrorResponse(t,e))))}catch(e){return i.ErrorResponse(t,e)}}],t.tournamentDelete=[n.body("tournamentId").isLength({min:1}).trim().withMessage("tournament Id name must be specified."),n.sanitizeBody("tournamentId").escape(),async(e,t)=>{try{const s=n.validationResult(e);if(s.isEmpty()){const s=await a.default.findByIdAndDelete(e.body.tournamentId);return s?i.successResponse(t,"Match Deleted"):i.ErrorResponse(t,s)}return i.validationErrorWithData(t,"Validation Error.",s.array())}catch(e){return i.ErrorResponse(t,e)}}],t.createMatch=[n.body("team1").isLength({min:1}).trim().withMessage("team1 must be specified."),n.body("team2").isLength({min:1}).trim().withMessage("team1 must be specified."),n.body("time").isLength({min:1}).trim().withMessage("time must be specified."),n.sanitizeBody("title").escape(),async(e,t)=>{try{const s=n.validationResult(e);if(s.isEmpty()){let s={tournamentId:e.body.tournamentId,team1:e.body.team1,team2:e.body.team2,time:e.body.time,venue:e.body.venue,winner:e.body.winner,isStarted:e.body.isStarted,team1Squard:e.body.team1Squard,team2Squard:e.body.team2Squard};const r=await a.default.findOneAndUpdate({_id:e.body.tournamentId},{$push:{matches:s}},{upsert:!0,new:!0}).catch((e=>i.ErrorResponse(t,e)));return i.successResponseWithData(t,"Operation success",r)}return i.validationErrorWithData(t,"Validation Error.",s.array())}catch(e){return i.ErrorResponse(t,e)}}],t.voteMatch=[async(e,t)=>{try{a.default.findOne({_id:e.body.tournamentId,"matches._id":e.body._id},{},{},(function(s,r){var a=r.matches.find((t=>t._id==e.body._id));a.team1Squard=a.team1Squard.filter((t=>t!=e.body.player._id)),a.team2Squard=a.team2Squard.filter((t=>t!=e.body.player._id)),"team1Squard"==e.body.selectedTeam?a.team1Squard.push(e.body.player):"team2Squard"==e.body.selectedTeam&&a.team2Squard.push(e.body.player),r.save().then((e=>i.successResponseWithData(t,"Match Updated successfuly",e))).catch((e=>i.ErrorResponse(t,e)))}))}catch(e){return i.ErrorResponse(t,e)}}],t.updateMatch=[n.body("team1").isLength({min:1}).trim().withMessage("team1 must be specified."),n.body("team2").isLength({min:1}).trim().withMessage("team1 must be specified."),n.body("time").isLength({min:1}).trim().withMessage("time must be specified."),n.sanitizeBody("title").escape(),async(e,t)=>{try{a.default.findOneAndUpdate({_id:e.body.tournamentId,"matches._id":e.body._id},{$set:{"matches.$.team2":e.body.team2,"matches.$.team1":e.body.team1,"matches.$.time":e.body.time,"matches.$.venue":e.body.venue,"matches.$.winner":e.body.winner,"matches.$.isStarted":e.body.isStarted,"matches.$.team1Squard":e.body.team1Squard,"matches.$.team2Squard":e.body.team2Squard}},null,((e,s)=>{if(!e)return i.successResponseWithData(t,"Match Updated successfuly",s);console.log("Error:",e),process.exit(0)}))}catch(e){return i.ErrorResponse(t,e)}}],t.updateTournamentUser=[async(e,t)=>{try{const s=n.validationResult(e);if(s.isEmpty()){const s=await o.default.find({_id:{$in:e.body.users}},(function(e,t){console.log(t)}));return a.default.findOneAndUpdate({_id:e.body.tournamentId},{users:s}).then((e=>i.successResponse(e,"User Updated"))).catch((e=>i.ErrorResponse(t,e))),i.successResponse(t,"User Updated")}return i.validationErrorWithData(t,"Validation Error.",s.array())}catch(e){return i.ErrorResponse(t,e)}}],t.getTournaments=[async(e,t)=>{try{const s=n.validationResult(e),{mobileNumber:r}=e.query;if(!s.isEmpty())return i.validationErrorWithData(t,"Validation Error.",s.array());if(r){const e={mobileNumber:r},s=await o.default.findOne(e);if(!s)return i.ErrorResponse(t,"User not found !!");const n=await a.default.find({users:s._id}).populate("users","userName").populate("matches.team1Squard","userName").populate("matches.team2Squard","userName").catch((e=>i.ErrorResponse(t,e)));return n?i.successResponseWithData(t,"Operation success",n):i.successResponseWithData(t,"Operation success",[])}await a.default.find({}).populate("users","userName").populate("matches.team1Squard").populate("matches.team2Squard").then((e=>i.successResponseWithData(t,"Tournament Get Success",e))).catch((e=>i.ErrorResponse(t,e)))}catch(e){return i.ErrorResponse(t,e)}}],t.deleteMatch=[async(e,t)=>{try{const s=n.validationResult(e);if(!s.isEmpty())return i.validationErrorWithData(t,"Validation Error.",s.array());console.log(e.body.tournamentId),a.default.findById(e.body.tournamentId,(async(s,r)=>{if(null===r)return i.notFoundResponse(t,"Tournament not exists with this id");{const s={matches:{_id:e.body._id}};a.default.findByIdAndUpdate(e.body.tournamentId,{$pull:s},(function(e,s){return e?i.notFoundResponse(t,"Errorrr"):i.successResponseWithData(t,"ho ho ho ",s)}))}}))}catch(e){return i.ErrorResponse(t,e)}}]},201:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createUser=t.getUsers=t.updateUser=t.UserDelete=void 0;const a=r(s(674)),o=r(s(997)),n=s(756),i=s(364);t.UserDelete=[n.body("userId").isLength({min:1}).trim().withMessage("User Id name must be specified."),n.sanitizeBody("userId").escape(),(e,t)=>{try{const s=n.validationResult(e);return s.isEmpty()?(a.default.findByIdAndDelete(e.body.userId).then((e=>i.successResponse(e,"User Deleted"))).catch((e=>i.ErrorResponse(t,e))),i.successResponse(t,"User Deleted")):i.validationErrorWithData(t,"Validation Error.",s.array())}catch(e){return i.ErrorResponse(t,e)}}],t.updateUser=[n.body("mobileNumber").isLength({min:1}).trim().withMessage("mobileNumber name must be specified."),n.sanitizeBody("mobileNumber").escape(),n.body("userName").isLength({min:1}).trim().withMessage("userName name must be specified."),n.sanitizeBody("userName").escape(),n.body("password").isLength({min:1}).trim().withMessage("password name must be specified."),n.sanitizeBody("password").escape(),(e,t)=>{try{const r=n.validationResult(e);if(!r.isEmpty())return i.validationErrorWithData(t,"Validation Error.",r.array());var s=new a.default({mobileNumber:e.body.mobileNumber,userName:e.body.userName,password:e.body.password,_id:e.body.userId});a.default.findByIdAndUpdate(e.body.userId,s).then((e=>i.successResponseWithData(t,"User updated",e))).catch((e=>i.ErrorResponse(t,e)))}catch(e){return i.ErrorResponse(t,e)}}],t.getUsers=[(e,t)=>{try{const s=n.validationResult(e),{tournamentId:r}=e.query;if(!s.isEmpty())return i.validationErrorWithData(t,"Validation Error.",s.array());{const e=r?{_id:r}:{};r?o.default.find(e).populate("users").then((e=>e.length?i.successResponseWithData(t,"Operation success",e):i.successResponseWithData(t,"Operation success",[]))).catch((e=>i.ErrorResponse(t,e))):a.default.find(e).then((e=>e.length?i.successResponseWithData(t,"Operation success",e):i.successResponseWithData(t,"Operation success",[]))).catch((e=>i.ErrorResponse(t,e)))}}catch(e){return i.ErrorResponse(t,e)}}],t.createUser=[n.body("userName").isLength({min:1}).trim().withMessage("User Name must be specified.").isAlphanumeric().withMessage("User Name has non-alphanumeric characters."),n.body("mobileNumber").isLength({min:1}).trim().withMessage("Mobile Number must be specified.").isMobilePhone("en-IN").withMessage("Mobile Number must be a valid mobile number").custom((e=>a.default.findOne({mobileNumber:e}).then((e=>{if(e)return Promise.reject("Mobile Number already in use")})))),n.body("password").isLength({min:6}).trim().withMessage("Password must be 6 characters or greater."),n.sanitizeBody("userName").escape(),n.sanitizeBody("mobileNumber").escape(),n.sanitizeBody("password").escape(),(e,t)=>{try{const s=n.validationResult(e);if(!s.isEmpty())return i.validationErrorWithData(t,"Validation Error.",s.array());new a.default({mobileNumber:e.body.mobileNumber,userName:e.body.userName,password:e.body.password}).save().then((e=>i.successResponseWithData(t,"User Created",e))).catch((e=>i.ErrorResponse(t,e)))}catch(e){return i.ErrorResponse(t,e)}}]},510:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(s(944));a.default.addColors({error:"red",warn:"yellow",info:"green",http:"magenta",debug:"white"});const o=a.default.format.combine(a.default.format.timestamp({format:"YYYY-MM-DD HH:mm:ss:ms"}),a.default.format.colorize({all:!0}),a.default.format.printf((e=>`${e.timestamp} ${e.level}: ${e.message}`))),n=[new a.default.transports.Console,new a.default.transports.File({filename:"logs/error.log",level:"error"}),new a.default.transports.File({filename:"logs/all.log"})],i=a.default.createLogger({level:"warn",levels:{error:0,warn:1,info:2,http:3,debug:4},format:o,transports:n});t.default=i},364:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unauthorizedResponse=t.validationErrorWithData=t.notFoundResponse=t.ErrorResponse=t.successResponseWithData=t.successResponse=void 0,t.successResponse=(e,t)=>{const s={status:1,message:t};return e.status(200).json(s)},t.successResponseWithData=(e,t,s)=>{const r={status:1,message:t,data:s};return e.status(200).json(r)},t.ErrorResponse=(e,t)=>{const s={status:0,message:t};return e.status(500).json(s)},t.notFoundResponse=(e,t)=>{const s={status:0,message:t};return e.status(404).json(s)},t.validationErrorWithData=(e,t,s)=>{const r={status:0,message:t,data:s};return e.status(400).json(r)},t.unauthorizedResponse=(e,t)=>{const s={status:0,message:t};return e.status(200).json(s)}},997:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(619),a=new r.Schema({tournamentId:{type:String,required:!0},team1:{type:String,required:!0},team2:{type:String,required:!0},time:{type:String,required:!0},venue:{type:String},winner:{type:String},isStarted:{type:Boolean},team1Squard:[{type:r.Schema.Types.ObjectId,ref:"User"}],team2Squard:[{type:r.Schema.Types.ObjectId,ref:"User"}]}),o=new r.Schema({title:{type:String,required:!0},matches:[a],users:[{type:r.Schema.Types.ObjectId,ref:"User"}]},{timestamps:!0});t.default=r.model("Tournament",o)},674:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=s(619),a=new r.Schema({userName:{type:String,required:!0},mobileNumber:{type:Number,required:!0},password:{type:String,required:!0}});t.default=r.model("User",a)},103:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MongoManager=void 0;const a=s(619),o=r(s(510)),n=process.env.MONGODB_URL||"mongodb+srv://boss:boss123@cluster0.ho84f.mongodb.net/cricket?retryWrites=true&w=majority";class i{constructor(){}static getInstance(){return i.instance||new i}InitMongo(){try{a.connect(n,{useNewUrlParser:!0,useUnifiedTopology:!0}).then((()=>{o.default.info(`Connected to - ${n}`),o.default.info("App is running ...")})).catch((e=>{o.default.error("mongo connection error:",e.message)}))}catch(e){o.default.error("mongo connection error:",e)}}}t.MongoManager=i},97:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(127),o=r(s(622)),n=s(929),i=s(268),u=s(201),d=o.default.join(__dirname,"./"),c=(o.default.join(d,"index.html"),a.Router());c.get("/",((e,t)=>{t.send("Hello")})),c.get("/get-tournaments",n.getTournaments),c.post("/tournament-register",n.tournamentRegister),c.delete("/delete-tournament",n.tournamentDelete),c.post("/update-tournament-user",n.updateTournamentUser),c.post("/create-match",n.createMatch),c.post("/update-match",n.updateMatch),c.post("/vote-match",n.voteMatch),c.delete("/delete-match",n.deleteMatch),c.post("/create-user",u.createUser),c.post("/update-user",u.updateUser),c.get("/get-users",u.getUsers),c.delete("/delete-user",u.UserDelete),c.post("/login-user",i.userLogin),c.post("/logout-user",i.userLogout),t.default=c},725:function(e,t,s){var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return a(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(s(127)),u=n(s(622)),d=s(103),c=n(s(97)),m=i.default();d.MongoManager.getInstance().InitMongo(),m.set("port",process.env.PORT||5e3),m.use(i.json()),m.use(i.urlencoded({extended:!1})),m.use(i.default.static(__dirname+"/")),m.get("/test",((e,t)=>{t.send("API Running")})),m.use("/api",c.default),m.get("/*",((e,t)=>{t.sendFile(u.default.join(__dirname+"/index.html"))}));const l=m.get("port"),p=m.listen(l,(()=>console.log(`Server started on port ${l}`)));t.default=p},127:e=>{e.exports=require("express")},756:e=>{e.exports=require("express-validator")},722:e=>{e.exports=require("jsonwebtoken")},619:e=>{e.exports=require("mongoose")},622:e=>{e.exports=require("path")},944:e=>{e.exports=require("winston")}},t={};!function s(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,s),o.exports}(725)})();