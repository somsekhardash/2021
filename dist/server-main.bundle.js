(()=>{"use strict";var e={268:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.userLogout=t.userLogin=void 0;const a=r(364),o=r(756),n=s(r(674)),i=s(r(722)),{sign:u}=i.default;let d=[];t.userLogin=[o.body("mobileNumber").isLength({min:1}).trim().withMessage("userName must be specified."),o.body("password").isLength({min:1}).trim().withMessage("Password must be specified."),o.sanitizeBody("email").escape(),o.sanitizeBody("password").escape(),(e,t)=>{try{const r=o.validationResult(e),{mobileNumber:s,password:i}=e.body;if(!r.isEmpty())return a.validationErrorWithData(t,"Validation Error.",r.array());n.default.findOne({mobileNumber:s}).then((e=>{if(e){if(e.password==i){const r={_id:e._id,userName:e.userName,mobileNumber:e.mobileNumber},s=r,o={expiresIn:86400};return r.token=u(s,"7032300186",o),a.successResponseWithData(t,"Login Success.",r)}return a.unauthorizedResponse(t,"MobileNumber or Password wrong.")}return a.unauthorizedResponse(t,"MobileNumber or Password wrong.")})).catch((e=>a.ErrorResponse(t,e)))}catch(e){return a.ErrorResponse(t,e)}}],t.userLogout=async function(e,t){try{const r=o.validationResult(e),{accessToken:s}=e.body;if(!r.isEmpty())return a.validationErrorWithData(t,"Validation Error.",r.array());d=[...d.filter((e=>s!==e))],a.successResponse(t,"User Logged Out")}catch(e){return a.ErrorResponse(t,e)}}},929:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteMatch=t.getTournaments=t.updateTournamentUser=t.updateMatch=t.voteMatch=t.createMatch=t.tournamentDelete=t.tournamentRegister=t.test=void 0;const a=s(r(997)),o=s(r(674)),n=r(756),i=r(364);t.test=[(e,t)=>i.successResponseWithData(t,"Ho Ho Ho !!",null)],t.tournamentRegister=[n.body("title").isLength({min:1}).trim().withMessage("Tournament name must be specified.").custom((e=>a.default.findOne({title:e}).then((e=>{if(e)return Promise.reject("Tournament already in use")})))),n.sanitizeBody("title").escape(),(e,t)=>{try{const r=n.validationResult(e);if(!r.isEmpty())return i.validationErrorWithData(t,"Validation Error.",r.array());new a.default({title:e.body.title}).save().then((e=>(console.log("=====>> Success",e),i.successResponseWithData(t,"Tournament Created",e)))).catch((e=>(console.log(e),i.ErrorResponse(t,e))))}catch(e){return i.ErrorResponse(t,e)}}],t.tournamentDelete=[n.body("tournamentId").isLength({min:1}).trim().withMessage("tournament Id name must be specified."),n.sanitizeBody("tournamentId").escape(),async(e,t)=>{try{const r=n.validationResult(e);if(r.isEmpty()){const r=await a.default.findByIdAndDelete(e.body.tournamentId);return r?i.successResponse(t,"Match Deleted"):i.ErrorResponse(t,r)}return i.validationErrorWithData(t,"Validation Error.",r.array())}catch(e){return i.ErrorResponse(t,e)}}],t.createMatch=[n.body("team1").isLength({min:1}).trim().withMessage("team1 must be specified."),n.body("team2").isLength({min:1}).trim().withMessage("team1 must be specified."),n.body("time").isLength({min:1}).trim().withMessage("time must be specified."),n.sanitizeBody("title").escape(),async(e,t)=>{try{const r=n.validationResult(e);if(r.isEmpty()){let r={tournamentId:e.body.tournamentId,team1:e.body.team1,team2:e.body.team2,time:e.body.time,venue:e.body.venue,winner:e.body.winner,isStarted:e.body.isStarted,team1Squard:e.body.team1Squard,team2Squard:e.body.team2Squard};const s=await a.default.findOneAndUpdate({_id:e.body.tournamentId},{$push:{matches:r}},{upsert:!0,new:!0}).catch((e=>i.ErrorResponse(t,e)));return i.successResponseWithData(t,"Operation success",s)}return i.validationErrorWithData(t,"Validation Error.",r.array())}catch(e){return i.ErrorResponse(t,e)}}],t.voteMatch=[async(e,t)=>{try{a.default.findOne({_id:e.body.tournamentId,"matches._id":e.body._id},{},{},(function(r,s){var a=s.matches.find((t=>t._id==e.body._id));a.team1Squard=a.team1Squard.filter((t=>t!=e.body.player._id)),a.team2Squard=a.team2Squard.filter((t=>t!=e.body.player._id)),"team1Squard"==e.body.selectedTeam?a.team1Squard.push(e.body.player):"team2Squard"==e.body.selectedTeam&&a.team2Squard.push(e.body.player),s.save().then((e=>i.successResponseWithData(t,"Match Updated successfuly",e))).catch((e=>i.ErrorResponse(t,e)))}))}catch(e){return i.ErrorResponse(t,e)}}],t.updateMatch=[n.body("team1").isLength({min:1}).trim().withMessage("team1 must be specified."),n.body("team2").isLength({min:1}).trim().withMessage("team1 must be specified."),n.body("time").isLength({min:1}).trim().withMessage("time must be specified."),n.sanitizeBody("title").escape(),async(e,t)=>{try{a.default.findOneAndUpdate({_id:e.body.tournamentId,"matches._id":e.body._id},{$set:{"matches.$.team2":e.body.team2,"matches.$.team1":e.body.team1,"matches.$.time":e.body.time,"matches.$.venue":e.body.venue,"matches.$.winner":e.body.winner,"matches.$.isStarted":e.body.isStarted,"matches.$.team1Squard":e.body.team1Squard,"matches.$.team2Squard":e.body.team2Squard}},null,((e,r)=>{if(!e)return i.successResponseWithData(t,"Match Updated successfuly",r);console.log("Error:",e),process.exit(0)}))}catch(e){return i.ErrorResponse(t,e)}}],t.updateTournamentUser=[async(e,t)=>{try{const r=n.validationResult(e);if(r.isEmpty()){const r=await o.default.find({_id:{$in:e.body.users}},(function(e,t){console.log(t)}));return a.default.findOneAndUpdate({_id:e.body.tournamentId},{users:r}).then((e=>i.successResponse(e,"User Updated"))).catch((e=>i.ErrorResponse(t,e))),i.successResponse(t,"User Updated")}return i.validationErrorWithData(t,"Validation Error.",r.array())}catch(e){return i.ErrorResponse(t,e)}}],t.getTournaments=[async(e,t)=>{try{const r=n.validationResult(e),{mobileNumber:s}=e.query;if(!r.isEmpty())return i.validationErrorWithData(t,"Validation Error.",r.array());if(s){const e={mobileNumber:s},r=await o.default.findOne(e);if(!r)return i.ErrorResponse(t,"User not found !!");const n=await a.default.find({users:r._id}).populate("users","userName").populate("matches.team1Squard","userName").populate("matches.team2Squard","userName").catch((e=>i.ErrorResponse(t,e)));return n?i.successResponseWithData(t,"Operation success",n):i.successResponseWithData(t,"Operation success",[])}await a.default.find({}).populate("users","userName").populate("matches.team1Squard").populate("matches.team2Squard").then((e=>i.successResponseWithData(t,"Tournament Get Success",e))).catch((e=>i.ErrorResponse(t,e)))}catch(e){return i.ErrorResponse(t,e)}}],t.deleteMatch=[async(e,t)=>{try{const r=n.validationResult(e);if(!r.isEmpty())return i.validationErrorWithData(t,"Validation Error.",r.array());console.log(e.body.tournamentId),a.default.findById(e.body.tournamentId,(async(r,s)=>{if(null===s)return i.notFoundResponse(t,"Tournament not exists with this id");{const r={matches:{_id:e.body._id}};a.default.findByIdAndUpdate(e.body.tournamentId,{$pull:r},(function(e,r){return e?i.notFoundResponse(t,"Errorrr"):i.successResponseWithData(t,"ho ho ho ",r)}))}}))}catch(e){return i.ErrorResponse(t,e)}}]},201:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createUser=t.getUsers=t.updateUser=t.UserDelete=void 0;const a=s(r(674)),o=s(r(997)),n=r(756),i=r(364);t.UserDelete=[n.body("userId").isLength({min:1}).trim().withMessage("User Id name must be specified."),n.sanitizeBody("userId").escape(),(e,t)=>{try{const r=n.validationResult(e);return r.isEmpty()?(a.default.findByIdAndDelete(e.body.userId).then((e=>i.successResponse(e,"User Deleted"))).catch((e=>i.ErrorResponse(t,e))),i.successResponse(t,"User Deleted")):i.validationErrorWithData(t,"Validation Error.",r.array())}catch(e){return i.ErrorResponse(t,e)}}],t.updateUser=[n.body("mobileNumber").isLength({min:1}).trim().withMessage("mobileNumber name must be specified."),n.sanitizeBody("mobileNumber").escape(),n.body("userName").isLength({min:1}).trim().withMessage("userName name must be specified."),n.sanitizeBody("userName").escape(),n.body("password").isLength({min:1}).trim().withMessage("password name must be specified."),n.sanitizeBody("password").escape(),(e,t)=>{try{const s=n.validationResult(e);if(!s.isEmpty())return i.validationErrorWithData(t,"Validation Error.",s.array());var r=new a.default({mobileNumber:e.body.mobileNumber,userName:e.body.userName,password:e.body.password,_id:e.body.userId});a.default.findByIdAndUpdate(e.body.userId,r).then((e=>i.successResponseWithData(t,"User updated",e))).catch((e=>i.ErrorResponse(t,e)))}catch(e){return i.ErrorResponse(t,e)}}],t.getUsers=[(e,t)=>{try{const r=n.validationResult(e),{tournamentId:s}=e.query;if(!r.isEmpty())return i.validationErrorWithData(t,"Validation Error.",r.array());{const e=s?{_id:s}:{};s?o.default.find(e).populate("users").then((e=>e.length?i.successResponseWithData(t,"Operation success",e):i.successResponseWithData(t,"Operation success",[]))).catch((e=>i.ErrorResponse(t,e))):a.default.find(e).then((e=>e.length?i.successResponseWithData(t,"Operation success",e):i.successResponseWithData(t,"Operation success",[]))).catch((e=>i.ErrorResponse(t,e)))}}catch(e){return i.ErrorResponse(t,e)}}],t.createUser=[n.body("userName").isLength({min:1}).trim().withMessage("User Name must be specified.").isAlphanumeric().withMessage("User Name has non-alphanumeric characters."),n.body("mobileNumber").isLength({min:1}).trim().withMessage("Mobile Number must be specified.").isMobilePhone("en-IN").withMessage("Mobile Number must be a valid mobile number").custom((e=>a.default.findOne({mobileNumber:e}).then((e=>{if(e)return Promise.reject("Mobile Number already in use")})))),n.body("password").isLength({min:6}).trim().withMessage("Password must be 6 characters or greater."),n.sanitizeBody("userName").escape(),n.sanitizeBody("mobileNumber").escape(),n.sanitizeBody("password").escape(),(e,t)=>{try{const r=n.validationResult(e);if(!r.isEmpty())return i.validationErrorWithData(t,"Validation Error.",r.array());new a.default({mobileNumber:e.body.mobileNumber,userName:e.body.userName,password:e.body.password}).save().then((e=>i.successResponseWithData(t,"User Created",e))).catch((e=>i.ErrorResponse(t,e)))}catch(e){return i.ErrorResponse(t,e)}}]},510:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=s(r(944));a.default.addColors({error:"red",warn:"yellow",info:"green",http:"magenta",debug:"white"});const o=a.default.format.combine(a.default.format.timestamp({format:"YYYY-MM-DD HH:mm:ss:ms"}),a.default.format.colorize({all:!0}),a.default.format.printf((e=>`${e.timestamp} ${e.level}: ${e.message}`))),n=[new a.default.transports.Console,new a.default.transports.File({filename:"logs/error.log",level:"error"}),new a.default.transports.File({filename:"logs/all.log"})],i=a.default.createLogger({level:"warn",levels:{error:0,warn:1,info:2,http:3,debug:4},format:o,transports:n});t.default=i},364:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unauthorizedResponse=t.validationErrorWithData=t.notFoundResponse=t.ErrorResponse=t.successResponseWithData=t.successResponse=void 0,t.successResponse=(e,t)=>{const r={status:1,message:t};return e.status(200).json(r)},t.successResponseWithData=(e,t,r)=>{const s={status:1,message:t,data:r};return e.status(200).json(s)},t.ErrorResponse=(e,t)=>{const r={status:0,message:t};return e.status(500).json(r)},t.notFoundResponse=(e,t)=>{const r={status:0,message:t};return e.status(404).json(r)},t.validationErrorWithData=(e,t,r)=>{const s={status:0,message:t,data:r};return e.status(400).json(s)},t.unauthorizedResponse=(e,t)=>{const r={status:0,message:t};return e.status(200).json(r)}},172:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(619),a=new s.Schema({data:{type:String,required:!0},user:{type:String,required:!0},type:{type:String,required:!0}},{timestamps:!0});t.default=s.model("Message",a)},997:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(619),a=new s.Schema({tournamentId:{type:String,required:!0},team1:{type:String,required:!0},team2:{type:String,required:!0},time:{type:String,required:!0},venue:{type:String},winner:{type:String},isStarted:{type:Boolean},team1Squard:[{type:s.Schema.Types.ObjectId,ref:"User"}],team2Squard:[{type:s.Schema.Types.ObjectId,ref:"User"}]}),o=new s.Schema({title:{type:String,required:!0},matches:[a],users:[{type:s.Schema.Types.ObjectId,ref:"User"}]},{timestamps:!0});t.default=s.model("Tournament",o)},674:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(619),a=new s.Schema({userName:{type:String,required:!0},mobileNumber:{type:Number,required:!0},password:{type:String,required:!0}});t.default=s.model("User",a)},103:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MongoManager=void 0;const a=s(r(619)),o=s(r(510)),{connect:n}=a.default,i=process.env.MONGODB_URL||"mongodb+srv://boss:boss123@cluster0.ho84f.mongodb.net/cricket?retryWrites=true&w=majority";class u{constructor(){}static getInstance(){return u.instance||new u}InitMongo(){try{n(i,{useNewUrlParser:!0,useUnifiedTopology:!0}).then((()=>{o.default.info(`Connected to - ${i}`),o.default.info("App is running ...")})).catch((e=>{o.default.error("mongo connection error:",e.message)}))}catch(e){o.default.error("mongo connection error:",e)}}}t.MongoManager=u},97:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const n=o(r(127)),i=o(r(622)),{Router:u}=n,d=r(929),c=r(268),m=r(201),l=i.join(__dirname,"./"),p=(i.join(l,"index.html"),u());p.get("/",((e,t)=>{t.send("Hello")})),p.get("/get-tournaments",d.getTournaments),p.post("/tournament-register",d.tournamentRegister),p.delete("/delete-tournament",d.tournamentDelete),p.post("/update-tournament-user",d.updateTournamentUser),p.post("/create-match",d.createMatch),p.post("/update-match",d.updateMatch),p.post("/vote-match",d.voteMatch),p.delete("/delete-match",d.deleteMatch),p.post("/create-user",m.createUser),p.post("/update-user",m.updateUser),p.get("/get-users",m.getUsers),p.delete("/delete-user",m.UserDelete),p.post("/login-user",c.userLogin),p.post("/logout-user",c.userLogout),t.default=p},725:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return a(t,e),t},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.app=void 0;const i=n(r(127)),u=n(r(97)),d=n(r(479)),c=o(r(622)),m=r(605),l=r(103),p=r(368),h=n(r(510)),{json:f,urlencoded:y}=i.default,b=process.env.PORT||3e3;t.app=i.default();const g=m.createServer(t.app);t.app.use(f()),t.app.use(y({extended:!1})),t.app.use(d.default());try{l.MongoManager.getInstance().InitMongo()}catch(e){h.default.error(e)}t.app.use("/api",u.default),t.app.get("/test",((e,t)=>{t.send("It's Working")})),t.app.use(i.default.static(__dirname+"/")),t.app.get("/*",((e,t)=>{t.sendFile(c.join(__dirname+"/index.html"))})),g.listen(b,(()=>{h.default.info(`Example app listening at http://localhost:${b}`)})),p.SocketManager.getInstance().InitSocket(g)},368:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SocketManager=void 0;const a=r(395),o=s(r(510)),n=s(r(172));class i{constructor(){this.room=[]}static getInstance(){return i.instance||new i}async InitSocket(e){this.io=new a.Server(e,{cors:{origin:"*"}}),this.room=await n.default.find({}),o.default.info("web-socket connected");try{this.io.on("connection",(e=>{o.default.info(`web-socket ${e.id} connected`),e.on("vote",(async e=>{e.createdAt=new Date,this.room.push(e),this.io.emit("message",this.room),new n.default(e).save()})),e.on("open-room",(()=>{this.io.emit("message",this.room)})),e.on("chat",(e=>{e.createdAt=new Date,this.room.push(e),this.io.emit("message",this.room),new n.default(e).save()}))}))}catch(e){o.default.error(e)}}sendMessage(e,t){o.default.warn("I mma hhere"),o.default.warn(`${e} ${t}`),this.io.sockets.emit("VOTE-API",t)}}t.SocketManager=i},479:e=>{e.exports=require("cors")},127:e=>{e.exports=require("express")},756:e=>{e.exports=require("express-validator")},605:e=>{e.exports=require("http")},722:e=>{e.exports=require("jsonwebtoken")},619:e=>{e.exports=require("mongoose")},622:e=>{e.exports=require("path")},395:e=>{e.exports=require("socket.io")},944:e=>{e.exports=require("winston")}},t={};!function r(s){if(t[s])return t[s].exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,r),a.exports}(725)})();